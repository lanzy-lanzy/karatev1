{% extends "base.html" %}

{% block title %}Enter Result - BlackCobra Karate Club{% endblock %}

{% block page_title %}Enter Match Result{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <!-- Match Info Header -->
        <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">Match Details</h3>
            <p class="text-sm text-gray-500 mt-1">{{ match.event.name }} â€¢ {{ match.scheduled_time|date:"M d, Y H:i" }}</p>
        </div>
        
        <!-- Competitors Display -->
         <div class="px-6 py-6 border-b border-gray-200">
             <div class="flex items-center justify-center space-x-8">
                 <!-- Competitor 1 -->
                 <div class="text-center">
                     {% if match.competitor1.profile.profile_image %}
                         <img src="{{ match.competitor1.profile.profile_image.url }}" 
                              alt="{{ match.competitor1.profile.user.get_full_name }}"
                              class="w-16 h-16 rounded-full object-cover mx-auto border-2 border-red-200">
                     {% else %}
                         <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto">
                             <span class="text-red-600 font-bold text-xl">
                                 {{ match.competitor1.profile.user.first_name|slice:":1"|upper }}{{ match.competitor1.profile.user.last_name|slice:":1"|upper }}
                             </span>
                         </div>
                     {% endif %}
                     <p class="text-sm font-medium text-gray-900 mt-2">
                         {{ match.competitor1.profile.user.get_full_name|default:match.competitor1.profile.user.username }}
                     </p>
                     <p class="text-xs text-gray-500">{{ match.competitor1.get_belt_rank_display }} Belt</p>
                     <p class="text-xs text-gray-500">{{ match.competitor1.weight }}kg</p>
                 </div>
                 
                 <!-- VS -->
                 <div class="text-center">
                     <span class="text-2xl font-bold text-gray-400">VS</span>
                 </div>
                 
                 <!-- Competitor 2 -->
                 <div class="text-center">
                     {% if match.competitor2.profile.profile_image %}
                         <img src="{{ match.competitor2.profile.profile_image.url }}" 
                              alt="{{ match.competitor2.profile.user.get_full_name }}"
                              class="w-16 h-16 rounded-full object-cover mx-auto border-2 border-blue-200">
                     {% else %}
                         <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto">
                             <span class="text-blue-600 font-bold text-xl">
                                 {{ match.competitor2.profile.user.first_name|slice:":1"|upper }}{{ match.competitor2.profile.user.last_name|slice:":1"|upper }}
                             </span>
                         </div>
                     {% endif %}
                     <p class="text-sm font-medium text-gray-900 mt-2">
                         {{ match.competitor2.profile.user.get_full_name|default:match.competitor2.profile.user.username }}
                     </p>
                     <p class="text-xs text-gray-500">{{ match.competitor2.get_belt_rank_display }} Belt</p>
                     <p class="text-xs text-gray-500">{{ match.competitor2.weight }}kg</p>
                 </div>
             </div>
         </div>
        
        <!-- Result Form -->
        <form method="post" class="px-6 py-6 space-y-6">
            {% csrf_token %}
            
            <!-- Winner Selection -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">Select Winner</label>
                {% if errors.winner %}
                <p class="text-sm text-red-600 mb-2">{{ errors.winner }}</p>
                {% endif %}
                <div class="grid grid-cols-2 gap-4">
                    <label class="relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none hover:border-red-500 transition-colors min-h-[44px]">
                        <input type="radio" name="winner" value="{{ match.competitor1.id }}" 
                               class="sr-only" {% if form_data.winner == match.competitor1.id %}checked{% endif %}>
                        <span class="flex flex-1">
                            <span class="flex flex-col">
                                <span class="block text-sm font-medium text-gray-900">
                                    {{ match.competitor1.profile.user.get_full_name|default:match.competitor1.profile.user.username }}
                                </span>
                                <span class="mt-1 flex items-center text-sm text-gray-500">
                                    {{ match.competitor1.get_belt_rank_display }} Belt
                                </span>
                            </span>
                        </span>
                        <span class="pointer-events-none absolute -inset-px rounded-lg border-2 border-transparent peer-checked:border-red-500" aria-hidden="true"></span>
                    </label>
                    
                    <label class="relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none hover:border-blue-500 transition-colors min-h-[44px]">
                        <input type="radio" name="winner" value="{{ match.competitor2.id }}" 
                               class="sr-only" {% if form_data.winner == match.competitor2.id %}checked{% endif %}>
                        <span class="flex flex-1">
                            <span class="flex flex-col">
                                <span class="block text-sm font-medium text-gray-900">
                                    {{ match.competitor2.profile.user.get_full_name|default:match.competitor2.profile.user.username }}
                                </span>
                                <span class="mt-1 flex items-center text-sm text-gray-500">
                                    {{ match.competitor2.get_belt_rank_display }} Belt
                                </span>
                            </span>
                        </span>
                        <span class="pointer-events-none absolute -inset-px rounded-lg border-2 border-transparent peer-checked:border-blue-500" aria-hidden="true"></span>
                    </label>
                </div>
            </div>
            
            <!-- Scores -->
            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label for="competitor1_score" class="block text-sm font-medium text-gray-700">
                        {{ match.competitor1.profile.user.get_full_name|default:match.competitor1.profile.user.username }}'s Score
                    </label>
                    <input type="number" name="competitor1_score" id="competitor1_score" min="0"
                           value="{{ form_data.competitor1_score|default:0 }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm min-h-[44px] px-3 py-2 border">
                    {% if errors.competitor1_score %}
                    <p class="mt-1 text-sm text-red-600">{{ errors.competitor1_score }}</p>
                    {% endif %}
                </div>
                
                <div>
                    <label for="competitor2_score" class="block text-sm font-medium text-gray-700">
                        {{ match.competitor2.profile.user.get_full_name|default:match.competitor2.profile.user.username }}'s Score
                    </label>
                    <input type="number" name="competitor2_score" id="competitor2_score" min="0"
                           value="{{ form_data.competitor2_score|default:0 }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm min-h-[44px] px-3 py-2 border">
                    {% if errors.competitor2_score %}
                    <p class="mt-1 text-sm text-red-600">{{ errors.competitor2_score }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Notes -->
            <div>
                <label for="notes" class="block text-sm font-medium text-gray-700">Notes (Optional)</label>
                <textarea name="notes" id="notes" rows="3"
                          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                          placeholder="Add any notes about the match...">{{ form_data.notes }}</textarea>
            </div>
            
            <!-- Warning -->
            <div class="rounded-md bg-yellow-50 p-4">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Important</h3>
                        <p class="mt-1 text-sm text-yellow-700">
                            Once submitted, results will be locked and cannot be modified without admin override.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Actions -->
            <div class="flex items-center justify-end space-x-3 pt-4 border-t border-gray-200">
                <a href="{% url 'judge_results' %}" 
                   class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 min-h-[44px]">
                    Cancel
                </a>
                <button type="submit" 
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 min-h-[44px]">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Submit Result
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Add visual feedback for winner selection
document.querySelectorAll('input[name="winner"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.querySelectorAll('input[name="winner"]').forEach(r => {
            const label = r.closest('label');
            const border = label.querySelector('span:last-child');
            if (r.checked) {
                if (r.value === '{{ match.competitor1.id }}') {
                    border.classList.add('border-red-500');
                    border.classList.remove('border-transparent', 'border-blue-500');
                } else {
                    border.classList.add('border-blue-500');
                    border.classList.remove('border-transparent', 'border-red-500');
                }
            } else {
                border.classList.add('border-transparent');
                border.classList.remove('border-red-500', 'border-blue-500');
            }
        });
    });
});
</script>
{% endblock %}
